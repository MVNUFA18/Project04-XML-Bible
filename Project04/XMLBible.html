<!-- XMLBible.html
 -- James Skon: original version April, 2011
 -- Bob Kasper: revised March, 2018
 -- Dante Cherubini: revised April, 2019
 -- Mount Vernon Nazarene University
 -->
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<html>
<head>
<title>Dante's Lexicon Bible</title>
<script type='text/javascript' src='XMLBible.js'></script>
function setup() {
  if (window.XMLHttpRequest)
   {// code for IE7+, Firefox, Chrome, Opera, Safari
    xmlhttp=new XMLHttpRequest();
    }
  else
    {// code for IE6, IE5
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
  // location of XML Bible files, must be on same web server
  // that hosts this web page to avoid Cross-Domain request restrictions
    biblePath = "/class/csc3004/XMLBible/kjv_by_book/";
    lexiconPath = "/class/csc3004/XMLBible/";
    lexiconVerses = "/class/csc3004/XMLBible/bible_refs_of_strong_numbers/";

    lexiconDiv = document.getElementById("lexiconDiv");
    verseDiv = document.getElementByID("verseDiv")

}


    function displayLexicon(lexiconID) {
        //start by clearing out Lexicon
        while (lexiconDiv.firstChild) {
            lexiconDiv.removeChild(lexiconDiv.firstChild);
        }

        lexiconID = lexiconID.replace('*', '');
        var isHebrew = false;

        var lexiconLanguage;
        //Checks first character for Hebrew or Greek
        if (lexiconID.charAt(0) == 'H') {
            isHebrew = true;
        }
        else if (lexiconID.charAt(0) == 'G') {
            isHeb = false;
        }

        //Now that we've used the lexiconID to determine Hebrew/Greek, replace letters with empty space (remove letters)
        lexiconID = lexiconID.replace(/\D/g, '');

        //Construct a string using isHeb flag to determine if greek or hebrew; cut ID down to get a proper index - works bc we removed letters
        lexiconLanguage = (isHeb ? "heb_strongs/" : "greek_strongs/") + (isHeb ? "heb" : "grk") + Math.floor(lexiconID / 100) + ".xml";

        //Append the completed lexiconLanguage string to path, set XMLLexicon equal to this
        var XMLLexicon = lexiconPath + lexiconLanguage;
        xmlhttp.open("GET", XMLLexicon, false);
        xmlhttp.send();


        var response = xmlhttp.responseXML;
        //We will need the H or G back, use isHeb flag from earlier - then we can get the element by this ID
        var lexID = (isHeb ? "H" : "G") + lexiconID;
        var responseNode = response.getElementById(lexID);

        //Title
        var titleNode = document.createElement("H1");
        titleNode.innerHTML = responseNode.getElementsByTagName("title")[0].innerHTML;
        lexiconDiv.appendChild(titleNode);

        //ID
        var idNode = document.createElement("H4");
        idNode.innerHTML = responseNode.getElementsByTagName("strong_id")[0].innerHTML;
        lexiconDiv.appendChild(idNode);

        //Transliteration
        var translitNode = document.createelement("H3");
        translitNode.innerHTML = responseNode.getElementsByTagName("transliteration")[0].innerHTML;
        lexiconDiv.appendChild(translitNode);

        //Pronunciation
        var pronunciationNode = document.createElement("H4");
        //Wrap in italix
        pronunciationNode.innerHTML = "<i>" + responseNode.getElementsByTagName("pronunciation")[0].children[0].innerHTML + "</i>";
        lexiconDiv.appendChild(pronunciationNode);

        //Description
        var descriptionNode = document.createElement("P");
        var descriptionXMLNode = responseNode.getElementsByTagName("description")[0];

        var descriptionString = "";

        //for every child
        for (i = 0; i < descriptionXMLNode.childNodes.length; i++) {
            var currentNode = descriptionXMLNode.childNodes[i];

            //If we find text nodes, add the text to string
            if (currentNode.nodeType == Node.TEXT_NODE) {
                descriptionString += currentNode.nodeValue;
            }
            
            if (currentNode.nodeType == Node.ELEMENT_NODE) {
                //Check if nodename is link, add lexicon if so
                if (currentNode.nodeName == "link") {
                    descriptionString += getStrongsLexicon(currentNode);
                }
                else descriptionString += currentNode.outerHTML;
            }
        }

        descriptionNode.innerHTML = descriptionString;
        //Now the final child is ready to be appended
        lexiconDiv.appendChild(descriptionNode);
    }

    function getResponse() {
        //Start by reading the input and storing it in vars
        var useStrongs = document.getElementByID('useStrongs').checked;
        var book = document.getElementByID('book').value;
        var chapter = document.getElementById('chapter').value;
        var verse = parseInt(document.getElementById('verse').value);
        var numberOfVerses = parseInt(document.getElementById('num_verses').value);

        var XMLBook = biblePath + book + ".xml";
        xmlhttp.open("GET", XMLBook, false);
        xmlhttp.send();
        xmlDoc = xmlhttp.responseXML;

        document.all.headArea.innerHTML = "<h1> XML Bible </h1><br>";
        document.all.responseArea.innerHTML = " ";

        var initialization = false;
        var currentChapter = chapter, currentVerse = verse;

        //loop through for every verse
        for (var i = 0; i < numberOfVerses; i++) {

            try {
                //grab next verse and append it to response
                verseText = getVerse(currentChapter, currentVerse, useStrongs);
                document.all.responseArea.innerHTML += "<p>" + verseText + "</p>";
                currentVerse++;

                //if we get here on the i = 0 run, initialized successfully
                if (i == 0) {
                    initialization = true;
                }
            }
            //Catch error and determine what caused the error
            catch (error) {
                //Fails to initialize and has errors
                if (!initialization) {
                    if (error == "NO BOOK") {
                        document.all.responseArea.innerHTML += "<b><i> No book found: " + book + "</i></b>";
                    }
                    else if (error == "NO CHAPTER") {
                        document.all.responseArea.innerHTML += "<b><i> No chapter found: " + chapter + "</i></b>";
                    }
                    else if (error == "NO VERSE") {
                        document.all.responseArea.innerHTML += "<b><i> No verse found: " + verse + "</i></b>";
                    }
                    break;
                }
                //Initializes correctly but has errors
                else {
                    if (error == "NO BOOK") {
                        document.all.responseArea.innerHTML += "<b><i> End of Book </i></b>";
                    }
                    else if (error == "NO CHAPTER") {
                        document.all.responseArea.innerHTML += "<b><i> End of Book </i></b>";
                        break;
                    }
                    //If we initialize but run out of verses, increment the chapter, reset verse, and continue
                    else if (error == "NO VERSE") {
                        currentChapter++;
                        currentVerse = 1;
                        i--;
                        continue;
                    }
                }
            }
        }
    }

    function getVerse(chapter, verse, useStrongs) {
        var verseOutput = xmlDoc.getElementsByTagName("book")[0].getAttribute("name");
        //Check that chapter exists
        var chap = xmlDoc.getElementsByTagName("chapter")[chapter - 1];
        if (chap == null) {
            throw "NO CHAPTER";
        }

        verseOutput += " ";
        verseOutput += chap.getAttribute("number");

        var ver = chap.getElementsByTagName("verse")[verse - 1];
        if (ver == null) {
            throw "NO VERSE";
        }
        verseOutput += ":";
        verseOutput += ver.getAttribute("number");
        verseOutput += " ";

        //prevents clunky spacing issue when a previous entry was lexicon strongs
        //add space if not using strongs, there is no punctuation, and strongs was just used
        var previousUsedStrongs = false;

        for (i = 0; i < ver.childNodes.length; i++) {
            var currentHasPunctuation = /[,.?!\-:;'"]/.test(v.childNodes[j].nodeValue);
            if (!useStrongs && !currentHasPunctuation && previousUsedStrongs) {
                verseOutput += " ";
            }

            previousUsedStrongs = false;
            var currentNode = v.childNodes[i];

            //If a text node, append text
            if (currentNode.nodeType == 3) {
                verseOutput += ver.childNodes[i].nodeValue;
                verseOutput += " ";
            }

            //If a tag node
            if (currentNode.nodeType == 1) {
                //Vary behavior depending on tag
                if (currentNode.nodeName == "em") {
                    verseOutput += "<i>";
                    verseOutput += currentNode.childNodes[0].nodeValue;
                    verseOutput += "</i>";
                }

                if (currentNode.nodeName == "strongs") {
                    previousUsedStrongs = true;

                    //if child node has a value, append it to verseOutput
                    if (currentNode.childNodes[0] != null) {
                        verseOutput += currentNode.childNodes[0].nodeValue;
                    }

                    if (useStrongs) {
                        verseOutput += getStrongsFormat(currentNode);
                    }
                }
            }
        
        }
        return (verseOutput);
    }

    var HEBREW_COLOR = "green";
    var GREEK_COLOR = "red";
    var NUMBER_COLOR = "blue";

    function getStrongsFormat(node) {

        var ID = "";
        var color = "";
        var letter = ""

        if (node.hasAttribute("hebrew")) {
            ID = "hebrew";
            letter = "H";
            color = HEBREW_COLOR;
        }

        if (node.hasAttribute("greek")) {
            ID = "greek";
            letter = "G";
            color = GREEK_COLOR;
        }

        if (node.hasAttribute("number")) {
            ID = "number";
            letter = "N";
            color = NUMBER_COLOR;
        }

        var idGrouper = node.getAttribute(ID);

        var returnString = "";

        var splitIdGroup = idGrouper.split(" ");
        for (var i = 0; i < splitIdGroup.length; i++) {
            returnString += "<i onclick='displayLexicon(\"" + splitIdGroup[i] + "\")'><font color=" + color + ">";
            returnString += splitIdGroup[i];
            returnString += "</font></i> ";
        }

        return returnString;
    }
<link rel="stylesheet" type="text/css" href="BibleStyle.css" />
</head>
<body onLoad="setup()">
    <form onsubmit="return false">
       
        <div id="formDiv" style="float:left; max-width: 55%; padding-left: 5%">
            <h1> The Cherubini Bible and Lexicon </h1><br>

            <h4 style="float: left; vertical-align: middle; margin-top: 0px;"> Strong's Lexicon
            <INPUT NAME="useStrongs" TYPE="checkbox" id=useStrongs checked="checked" style="float: left;">
            </h4>    
            
            <div id="lookupDiv">
            <TABLE>
                <TR>
                    <TD ALIGN=LEFT VALIGN=TOP>Book</TD>
                    <TD ALIGN=LEFT VALIGN=TOP>Chapter</TD>
                    <TD>:</TD>
                    <TD ALIGN=LEFT VALIGN=TOP>Verse</TD>
                    <TD ALIGN=LEFT VALIGN=TOP>Number of Verses</TD>
                </TR>
                <TR>
                    <TD ALIGN=LEFT VALIGN=TOP>
                        <select name="book" class="biblestyle" id=book>
                            <option value="1">Genesis
                            <option value="2">Exodus
                            <option value="3">Leviticus
                            <option value="4">Numbers
                            <option value="5">Deuteronomy
                            <option value="6">Joshua
                            <option value="7">Judges
                            <option value="8">Ruth
                            <option value="9">1st Samuel
                            <option value="10">2nd Samuel
                            <option value="11">1st Kings
                            <option value="12">2nd Kings
                            <option value="13">1st Chronicles
                            <option value="14">2nd Chronicles
                            <option value="15">Ezra
                            <option value="16">Nehemiah
                            <option value="17">Esther
                            <option value="18">Job
                            <option value="19">Psalms
                            <option value="20">Proverbs
                            <option value="21">Ecclesiastes
                            <option value="22">Song of Solomon
                            <option value="23">Isaiah
                            <option value="24">Jeremiah
                            <option value="25">Lamentations
                            <option value="26">Ezekiel
                            <option value="27">Daniel
                            <option value="28">Hosea
                            <option value="29">Joel
                            <option value="30">Amos
                            <option value="31">Obadiah
                            <option value="32">Jonah
                            <option value="33">Micah
                            <option value="34">Nahum
                            <option value="35">Habakkuk
                            <option value="36">Zephaniah
                            <option value="37">Haggai
                            <option value="38">Zechariah
                            <option value="39">Malachi
                            <option value="40">Matthew
                            <option value="41">Mark
                            <option value="42">Luke
                            <option value="43">John
                            <option value="44">Acts
                            <option value="45">Romans
                            <option value="46">1st Corinthians
                            <option value="47">2nd Corinthians
                            <option value="48">Galatians
                            <option value="49">Ephesians
                            <option value="50">Philippians
                            <option value="51">Colossians
                            <option value="52">1st Thessalonians
                            <option value="53">2nd Thessalonians
                            <option value="54">1st Timothy
                            <option value="55">2nd Timothy
                            <option value="56">Titus
                            <option value="57">Philemon
                            <option value="58">Hebrews
                            <option value="59">James
                            <option value="60">1st Peter
                            <option value="61">2nd Peter
                            <option value="62">1st John
                            <option value="63">2nd John
                            <option value="64">3rd John
                            <option value="65">Jude
                            <option value="66">Revelation
                        </select>
                    </TD>
                    <TD ALIGN=LEFT VALIGN=TOP>
                        <INPUT NAME="chapter" TYPE="number" MAXLENGTH=3 class="bibleInput" id="chapter">
                    </TD>
                    <TD>:</TD>
                    <TD ALIGN=LEFT VALIGN=TOP>
                        <INPUT NAME="verse" TYPE="number" MAXLENGTH=3 class="bibleInput" id="verse">
                    </TD>
                    <TD ALIGN=LEFT VALIGN=TOP>
                        <INPUT NAME="num_verses" TYPE="number" class="bibleInput" id="num_verses">
                    </TD>
                </TR>
            </TABLE>

            <p>
                <input type="submit" onclick="javascript: getResponse()" name="submit" value="Submit" style="margin-top: 15px;" />
            </p>
            </div>
        </div>
    </form>
    <div id="headArea">
    </div>
    <div style="position:absolute; left:5%; top: 40%; height: 60%; width: 50%; text-align: center; padding: 10px 10px 10px 10px; border-color: black; border-style: solid; border-width: 5px; border-radius: 10px;" id="responseArea">
        <p> Enter a Bible verse</p>
    </div>
    
    <h4 style="position: absolute; height: 50%; width: 40%; right: 5%;"> Additional Information:
        <div id="lexiconDiv">
            <p style="font-family: Cambria; font-style: normal;"> Click a subscript to view</p>
        </div>
    </h4>
    <h4 style="width:30%; position: absolute; top: 50%; height: 30%; right: 5%;" > References which also contain this word: 
        <div style="height: 100%; border-width: 5px; border-radius: 8px; border-style: solid;" id="verseDiv">
            <p style="font-family: Cambria; font-style: normal;"> Click a subscript to view</p>
        </div>
    </h4>
</body>
</html>
